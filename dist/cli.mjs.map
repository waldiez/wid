{"version":3,"sources":["../typescript/src/cli.ts"],"sourcesContent":["#!/usr/bin/env node\n\nimport { closeSync, existsSync, mkdirSync, openSync, readFileSync, unlinkSync, writeFileSync } from \"node:fs\";\nimport { dirname, resolve } from \"node:path\";\nimport { spawn } from \"node:child_process\";\nimport { createHmac, createPrivateKey, createPublicKey, sign as cryptoSign, timingSafeEqual, verify as cryptoVerify } from \"node:crypto\";\nimport {\n  HLCWidGen,\n  parseHlcWid,\n  parseWid,\n  validateHlcWid,\n  validateWid,\n  WidGen,\n} from \"./index\";\nimport { parseTimeUnit, type TimeUnit } from \"./time\";\n\n/** CLI mode selector for WID vs HLC workflows. */\ntype Kind = \"wid\" | \"hlc\";\n\n/** Parsed CLI options that drive each command. */\ninterface Opts {\n  /** Operation kind (wid or hlc). */\n  kind: Kind;\n  node: string;\n  W: number;\n  Z: number;\n  timeUnit: TimeUnit;\n  count: number;\n  json: boolean;\n}\n\n/** Canonical mode parameters sent on CLI helpers. */\ninterface Canon {\n  A: string;\n  W: number;\n  L: number;\n  D: string;\n  I: string;\n  E: string;\n  Z: number;\n  T: TimeUnit;\n  R: string;\n  M: boolean;\n  N: number;\n  WID?: string;\n  KEY?: string;\n  SIG?: string;\n  DATA?: string;\n  OUT?: string;\n  MODE?: string;\n  CODE?: string;\n  DIGITS?: number;\n  MAX_AGE_SEC?: number;\n  MAX_FUTURE_SEC?: number;\n}\n\n/** Allowed transports recognized by the CLI. */\nconst LOCAL_SERVICE_TRANSPORTS = new Set([\"mqtt\", \"ws\", \"redis\", \"null\", \"stdout\"]);\n\nfunction printHelp(): void {\n  console.error(`wid - WID/HLC-WID generator CLI\n\nUsage:\n  wid next [--kind wid|hlc] [--node <name>] [--W <n>] [--Z <n>] [--time-unit sec|ms]\n  wid stream [--kind wid|hlc] [--node <name>] [--W <n>] [--Z <n>] [--time-unit sec|ms] [--count <n>]\n  wid validate <id> [--kind wid|hlc] [--W <n>] [--Z <n>] [--time-unit sec|ms]\n  wid parse <id> [--kind wid|hlc] [--W <n>] [--Z <n>] [--time-unit sec|ms] [--json]\n  wid healthcheck [--kind wid|hlc] [--node <name>] [--W <n>] [--Z <n>] [--time-unit sec|ms] [--json]\n  wid bench [--kind wid|hlc] [--node <name>] [--W <n>] [--Z <n>] [--time-unit sec|ms] [--count <n>]\n\nCanonical mode:\n  wid W=# A=# L=# D=# I=# E=# Z=# T=sec|ms R=auto|mqtt|ws|redis|null|stdout N=#\n  wid A=w-otp MODE=gen|verify KEY=<secret|path> [WID=<wid>] [CODE=<otp>] [DIGITS=6] [MAX_AGE_SEC=0] [MAX_FUTURE_SEC=5]\n  For A=stream: N=0 means infinite stream\n  E supports: state | stateless | sql`);\n}\n\nfunction printActions(): void {\n  console.log(`wid action matrix\n\nCore ID:\n  A=next | A=stream | A=healthcheck | A=sign | A=verify | A=w-otp\n\nService lifecycle (native):\n  A=discover | A=scaffold | A=run | A=start | A=stop | A=status | A=logs\n\nService modules (native):\n  A=saf      (alias: raf)\n  A=saf-wid  (aliases: waf, wraf)\n  A=wir      (alias: witr)\n  A=wism     (alias: wim)\n  A=wihp     (alias: wih)\n  A=wipr     (alias: wip)\n  A=duplex\n\nHelp:\n  A=help-actions`);\n}\n\nfunction parseIntStrict(value: string, name: string): number {\n  const n = Number.parseInt(value, 10);\n  if (!Number.isFinite(n) || Number.isNaN(n)) throw new Error(`invalid integer for ${name}`);\n  return n;\n}\n\nfunction parseOpts(args: string[], allowCount: boolean): Opts {\n  const opts: Opts = {\n    kind: \"wid\",\n    node: process.env.NODE ?? \"ts\",\n    W: 4,\n    Z: 6,\n    timeUnit: \"sec\",\n    count: 0,\n    json: false,\n  };\n\n  for (let i = 0; i < args.length; i += 1) {\n    const arg = args[i];\n    switch (arg) {\n      case \"--kind\":\n        if (i + 1 >= args.length) throw new Error(\"missing value for --kind\");\n        opts.kind = args[++i] as Kind;\n        break;\n      case \"--node\":\n        if (i + 1 >= args.length) throw new Error(\"missing value for --node\");\n        opts.node = args[++i];\n        break;\n      case \"--W\":\n        if (i + 1 >= args.length) throw new Error(\"missing value for --W\");\n        opts.W = parseIntStrict(args[++i], \"--W\");\n        break;\n      case \"--Z\":\n        if (i + 1 >= args.length) throw new Error(\"missing value for --Z\");\n        opts.Z = parseIntStrict(args[++i], \"--Z\");\n        break;\n      case \"--time-unit\":\n      case \"--T\":\n        if (i + 1 >= args.length) throw new Error(\"missing value for --time-unit\");\n        opts.timeUnit = parseTimeUnit(args[++i]);\n        break;\n      case \"--count\":\n        if (!allowCount) throw new Error(\"unknown flag: --count\");\n        if (i + 1 >= args.length) throw new Error(\"missing value for --count\");\n        opts.count = parseIntStrict(args[++i], \"--count\");\n        break;\n      case \"--json\":\n        opts.json = true;\n        break;\n      default:\n        throw new Error(`unknown flag: ${arg}`);\n    }\n  }\n\n  if (opts.kind !== \"wid\" && opts.kind !== \"hlc\") throw new Error(\"--kind must be one of: wid, hlc\");\n  if (opts.W <= 0) throw new Error(\"W must be > 0\");\n  if (opts.Z < 0) throw new Error(\"Z must be >= 0\");\n  if (opts.count < 0) throw new Error(\"count must be >= 0\");\n  return opts;\n}\n\nfunction runNext(args: string[]): void {\n  const opts = parseOpts(args, false);\n  if (opts.kind === \"wid\") {\n    console.log(new WidGen({ W: opts.W, Z: opts.Z, timeUnit: opts.timeUnit }).next());\n    return;\n  }\n  console.log(new HLCWidGen({ node: opts.node, W: opts.W, Z: opts.Z, timeUnit: opts.timeUnit }).next());\n}\n\nfunction runStream(args: string[]): void {\n  const opts = parseOpts(args, true);\n  if (opts.kind === \"wid\") {\n    const gen = new WidGen({ W: opts.W, Z: opts.Z, timeUnit: opts.timeUnit });\n    for (let i = 0; opts.count === 0 || i < opts.count; i += 1) console.log(gen.next());\n    return;\n  }\n  const gen = new HLCWidGen({ node: opts.node, W: opts.W, Z: opts.Z, timeUnit: opts.timeUnit });\n  for (let i = 0; opts.count === 0 || i < opts.count; i += 1) console.log(gen.next());\n}\n\nfunction runValidate(args: string[]): void {\n  if (args.length === 0) throw new Error(\"validate requires an id\");\n  const id = args[0];\n  const opts = parseOpts(args.slice(1), false);\n  const ok =\n    opts.kind === \"wid\"\n      ? validateWid(id, opts.W, opts.Z, opts.timeUnit)\n      : validateHlcWid(id, opts.W, opts.Z, opts.timeUnit);\n  console.log(ok ? \"true\" : \"false\");\n  if (!ok) throw new Error(\"invalid wid\");\n}\n\nfunction runParse(args: string[]): void {\n  if (args.length === 0) throw new Error(\"parse requires an id\");\n  const id = args[0];\n  const opts = parseOpts(args.slice(1), false);\n\n  if (opts.kind === \"wid\") {\n    const parsed = parseWid(id, opts.W, opts.Z, opts.timeUnit);\n    if (!parsed) {\n      console.log(\"null\");\n      throw new Error(\"invalid wid\");\n    }\n    if (opts.json) {\n      console.log(\n        JSON.stringify({\n          raw: parsed.raw,\n          timestamp: parsed.timestamp.toISOString(),\n          sequence: parsed.sequence,\n          padding: parsed.padding,\n        })\n      );\n      return;\n    }\n    console.log(`raw=${parsed.raw}`);\n    console.log(`timestamp=${parsed.timestamp.toISOString()}`);\n    console.log(`sequence=${parsed.sequence}`);\n    console.log(`padding=${parsed.padding ?? \"\"}`);\n    return;\n  }\n\n  const parsed = parseHlcWid(id, opts.W, opts.Z, opts.timeUnit);\n  if (!parsed) {\n    console.log(\"null\");\n    throw new Error(\"invalid wid\");\n  }\n  if (opts.json) {\n    console.log(\n      JSON.stringify({\n        raw: parsed.raw,\n        timestamp: parsed.timestamp.toISOString(),\n        logical_counter: parsed.logicalCounter,\n        node: parsed.node,\n        padding: parsed.padding,\n      })\n    );\n    return;\n  }\n  console.log(`raw=${parsed.raw}`);\n  console.log(`timestamp=${parsed.timestamp.toISOString()}`);\n  console.log(`logical_counter=${parsed.logicalCounter}`);\n  console.log(`node=${parsed.node}`);\n  console.log(`padding=${parsed.padding ?? \"\"}`);\n}\n\nfunction runHealthcheck(args: string[]): void {\n  const opts = parseOpts(args, false);\n  const sample =\n    opts.kind === \"wid\"\n      ? new WidGen({ W: opts.W, Z: opts.Z, timeUnit: opts.timeUnit }).next()\n      : new HLCWidGen({ node: opts.node, W: opts.W, Z: opts.Z, timeUnit: opts.timeUnit }).next();\n\n  const ok =\n    opts.kind === \"wid\"\n      ? validateWid(sample, opts.W, opts.Z, opts.timeUnit)\n      : validateHlcWid(sample, opts.W, opts.Z, opts.timeUnit);\n\n  if (opts.json) {\n    console.log(\n      JSON.stringify({\n        ok,\n        kind: opts.kind,\n        W: opts.W,\n        Z: opts.Z,\n        time_unit: opts.timeUnit,\n        sample_id: sample,\n      })\n    );\n  } else {\n    console.log(`ok=${ok ? \"true\" : \"false\"} kind=${opts.kind} sample=${sample}`);\n  }\n\n  if (!ok) throw new Error(\"healthcheck failed\");\n}\n\nfunction runBench(args: string[]): void {\n  const opts = parseOpts(args, true);\n  const n = opts.count > 0 ? opts.count : 100000;\n\n  const start = process.hrtime.bigint();\n  if (opts.kind === \"wid\") {\n    const g = new WidGen({ W: opts.W, Z: opts.Z, timeUnit: opts.timeUnit });\n    for (let i = 0; i < n; i += 1) g.next();\n  } else {\n    const g = new HLCWidGen({ node: opts.node, W: opts.W, Z: opts.Z, timeUnit: opts.timeUnit });\n    for (let i = 0; i < n; i += 1) g.next();\n  }\n  const secs = Number(process.hrtime.bigint() - start) / 1_000_000_000;\n  const s = Math.max(secs, 1e-9);\n  console.log(\n    JSON.stringify({\n      impl: \"typescript\",\n      kind: opts.kind,\n      W: opts.W,\n      Z: opts.Z,\n      time_unit: opts.timeUnit,\n      n,\n      seconds: s,\n      ids_per_sec: n / s,\n    })\n  );\n}\n\nfunction parseCanonical(args: string[]): Canon {\n  const out: Canon = {\n    A: \"next\",\n    W: 4,\n    L: 3600,\n    D: \"\",\n    I: \"auto\",\n    E: \"state\",\n    Z: 6,\n    T: \"sec\",\n    R: \"auto\",\n    M: false,\n    N: 0,\n  };\n\n  for (const arg of args) {\n    const [k, vRaw] = arg.split(\"=\", 2);\n    if (!vRaw) throw new Error(`expected KEY=VALUE, got '${arg}'`);\n    const v = vRaw === \"#\" ? defaultValueFor(k) : vRaw;\n\n    switch (k) {\n      case \"A\":\n        out.A = v.toLowerCase();\n        break;\n      case \"W\":\n        out.W = parseIntStrict(v, \"W\");\n        break;\n      case \"L\":\n        out.L = parseIntStrict(v, \"L\");\n        break;\n      case \"D\":\n        out.D = v;\n        break;\n      case \"I\":\n        out.I = v;\n        break;\n      case \"E\":\n        out.E = v;\n        break;\n      case \"Z\":\n        out.Z = parseIntStrict(v, \"Z\");\n        break;\n      case \"T\":\n        out.T = parseTimeUnit(v);\n        break;\n      case \"R\":\n        out.R = v;\n        break;\n      case \"M\":\n        out.M = [\"1\", \"true\", \"yes\", \"y\", \"on\"].includes(v.toLowerCase());\n        break;\n      case \"N\":\n        out.N = parseIntStrict(v, \"N\");\n        break;\n      case \"WID\":\n        out.WID = v;\n        break;\n      case \"KEY\":\n        out.KEY = v;\n        break;\n      case \"SIG\":\n        out.SIG = v;\n        break;\n      case \"DATA\":\n        out.DATA = v;\n        break;\n      case \"OUT\":\n        out.OUT = v;\n        break;\n      case \"MODE\":\n        out.MODE = v;\n        break;\n      case \"CODE\":\n        out.CODE = v;\n        break;\n      case \"DIGITS\":\n        out.DIGITS = parseIntStrict(v, \"DIGITS\");\n        break;\n      case \"MAX_AGE_SEC\":\n        out.MAX_AGE_SEC = parseIntStrict(v, \"MAX_AGE_SEC\");\n        break;\n      case \"MAX_FUTURE_SEC\":\n        out.MAX_FUTURE_SEC = parseIntStrict(v, \"MAX_FUTURE_SEC\");\n        break;\n      default:\n        throw new Error(`unknown key: ${k}`);\n    }\n  }\n\n  if (out.M) out.T = \"ms\";\n\n  out.A =\n    out.A === \"id\" || out.A === \"default\"\n      ? \"next\"\n      : out.A === \"hc\"\n      ? \"healthcheck\"\n      : out.A === \"raf\"\n      ? \"saf\"\n      : out.A === \"waf\" || out.A === \"wraf\"\n      ? \"saf-wid\"\n      : out.A === \"witr\"\n      ? \"wir\"\n      : out.A === \"wim\"\n      ? \"wism\"\n      : out.A === \"wih\"\n      ? \"wihp\"\n      : out.A === \"wip\"\n      ? \"wipr\"\n      : out.A;\n\n  if (out.W <= 0) throw new Error(\"W must be > 0\");\n  if (out.Z < 0 || out.N < 0 || out.L < 0) throw new Error(\"Z/N/L must be >= 0\");\n  if (![\"auto\", \"mqtt\", \"ws\", \"redis\", \"null\", \"stdout\"].includes(out.R)) {\n    throw new Error(\"invalid R transport\");\n  }\n\n  return out;\n}\n\nfunction defaultValueFor(key: string): string {\n  switch (key) {\n    case \"A\":\n      return \"next\";\n    case \"W\":\n      return \"4\";\n    case \"L\":\n      return \"3600\";\n    case \"D\":\n      return \"\";\n    case \"I\":\n      return \"auto\";\n    case \"E\":\n      return \"state\";\n    case \"Z\":\n      return \"6\";\n    case \"T\":\n      return \"sec\";\n    case \"R\":\n      return \"auto\";\n    case \"M\":\n      return \"false\";\n    case \"N\":\n      return \"0\";\n    case \"WID\":\n    case \"KEY\":\n    case \"SIG\":\n    case \"DATA\":\n    case \"OUT\":\n    case \"MODE\":\n    case \"CODE\":\n      return \"\";\n    case \"DIGITS\":\n      return \"6\";\n    case \"MAX_AGE_SEC\":\n      return \"0\";\n    case \"MAX_FUTURE_SEC\":\n      return \"5\";\n    default:\n      return \"\";\n  }\n}\n\nfunction b64urlEncode(buf: Buffer): string {\n  return buf.toString(\"base64\").replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=+$/g, \"\");\n}\n\nfunction b64urlDecode(s: string): Buffer {\n  let std = s.replace(/-/g, \"+\").replace(/_/g, \"/\");\n  const m = std.length % 4;\n  if (m === 2) std += \"==\";\n  else if (m === 3) std += \"=\";\n  else if (m === 1) throw new Error(\"invalid base64url signature length\");\n  return Buffer.from(std, \"base64\");\n}\n\nfunction buildSignVerifyMessage(c: Canon): Buffer {\n  const wid = c.WID ?? \"\";\n  if (!wid) throw new Error(\"WID=<wid_string> required\");\n  const parts: Buffer[] = [Buffer.from(wid, \"utf8\")];\n  if (c.DATA && c.DATA.length > 0) {\n    if (!existsSync(c.DATA)) throw new Error(`data file not found: ${c.DATA}`);\n    parts.push(readFileSync(c.DATA));\n  }\n  return Buffer.concat(parts);\n}\n\nfunction runSign(c: Canon): number {\n  const keyPath = c.KEY ?? \"\";\n  if (!keyPath) throw new Error(\"KEY=<private_key_path> required for A=sign\");\n  if (!existsSync(keyPath)) throw new Error(`private key file not found: ${keyPath}`);\n  const message = buildSignVerifyMessage(c);\n  const key = createPrivateKey(readFileSync(keyPath));\n  const sig = cryptoSign(null, message, key);\n  const out = b64urlEncode(sig);\n  if (c.OUT && c.OUT.length > 0) writeFileSync(c.OUT, out, \"utf8\");\n  else console.log(out);\n  return 0;\n}\n\nfunction runVerify(c: Canon): number {\n  const keyPath = c.KEY ?? \"\";\n  const sigText = c.SIG ?? \"\";\n  if (!keyPath) throw new Error(\"KEY=<public_key_path> required for A=verify\");\n  if (!sigText) throw new Error(\"SIG=<signature_string> required for A=verify\");\n  if (!existsSync(keyPath)) throw new Error(`public key file not found: ${keyPath}`);\n  const message = buildSignVerifyMessage(c);\n  const key = createPublicKey(readFileSync(keyPath));\n  const ok = cryptoVerify(null, message, key, b64urlDecode(sigText));\n  if (ok) {\n    console.log(\"Signature valid.\");\n    return 0;\n  }\n  console.error(\"Signature invalid.\");\n  return 1;\n}\n\nfunction resolveWOtpSecret(raw: string): string {\n  if (existsSync(raw)) return readFileSync(raw, \"utf8\").trim();\n  return raw.trim();\n}\n\nfunction computeWOtp(secret: string, wid: string, digits: number): string {\n  const digest = createHmac(\"sha256\", Buffer.from(secret, \"utf8\")).update(Buffer.from(wid, \"utf8\")).digest();\n  const binary = digest.readUInt32BE(0);\n  const mod = 10 ** digits;\n  return String(binary % mod).padStart(digits, \"0\");\n}\n\nfunction wotpWidTickMs(wid: string): number {\n  const m = /^(\\d{8})T(\\d{6})(\\d{3})?\\.[0-9]+Z/.exec(wid);\n  if (!m) throw new Error(\"WID timestamp is invalid for time-window verification\");\n  const date = m[1];\n  const hms = m[2];\n  const ms = m[3] ?? \"000\";\n  const y = Number(date.slice(0, 4));\n  const mo = Number(date.slice(4, 6));\n  const d = Number(date.slice(6, 8));\n  const hh = Number(hms.slice(0, 2));\n  const mm = Number(hms.slice(2, 4));\n  const ss = Number(hms.slice(4, 6));\n  const msec = Number(ms);\n  const tick = Date.UTC(y, mo - 1, d, hh, mm, ss, msec);\n  if (!Number.isFinite(tick)) throw new Error(\"WID timestamp is invalid for time-window verification\");\n  return tick;\n}\n\nfunction runWOtp(c: Canon): number {\n  const mode = (c.MODE ?? \"gen\").toLowerCase();\n  if (mode !== \"gen\" && mode !== \"verify\") throw new Error(\"MODE must be gen or verify for A=w-otp\");\n  if (!c.KEY || c.KEY.length === 0) throw new Error(\"KEY=<secret_or_path> required for A=w-otp\");\n  const secret = resolveWOtpSecret(c.KEY);\n  if (!secret) throw new Error(\"w-otp secret cannot be empty\");\n  const digits = c.DIGITS ?? 6;\n  if (!Number.isInteger(digits) || digits < 4 || digits > 10) throw new Error(\"DIGITS must be an integer between 4 and 10\");\n  const maxAgeSec = c.MAX_AGE_SEC ?? 0;\n  const maxFutureSec = c.MAX_FUTURE_SEC ?? 5;\n  if (!Number.isInteger(maxAgeSec) || maxAgeSec < 0) throw new Error(\"MAX_AGE_SEC must be a non-negative integer\");\n  if (!Number.isInteger(maxFutureSec) || maxFutureSec < 0) throw new Error(\"MAX_FUTURE_SEC must be a non-negative integer\");\n\n  let wid = c.WID ?? \"\";\n  if (!wid && mode === \"gen\") wid = new WidGen({ W: c.W, Z: c.Z, timeUnit: c.T }).next();\n  if (!wid) throw new Error(\"WID=<wid_string> required for A=w-otp MODE=verify\");\n\n  const otp = computeWOtp(secret, wid, digits);\n  if (mode === \"gen\") {\n    console.log(JSON.stringify({ wid, otp, digits }));\n    return 0;\n  }\n\n  const code = c.CODE ?? \"\";\n  if (!code) throw new Error(\"CODE=<otp_code> required for A=w-otp MODE=verify\");\n  if (maxAgeSec > 0 || maxFutureSec > 0) {\n    const widMs = wotpWidTickMs(wid);\n    const nowMs = Date.now();\n    const delta = nowMs - widMs;\n    if (delta < 0 && -delta > maxFutureSec * 1000) throw new Error(\"OTP invalid: WID timestamp is too far in the future\");\n    if (delta >= 0 && maxAgeSec > 0 && delta > maxAgeSec * 1000) throw new Error(\"OTP invalid: WID timestamp is too old\");\n  }\n  const got = Buffer.from(code, \"utf8\");\n  const exp = Buffer.from(otp, \"utf8\");\n  const ok = got.length === exp.length && timingSafeEqual(got, exp);\n  if (ok) {\n    console.log(\"OTP valid.\");\n    return 0;\n  }\n  console.error(\"OTP invalid.\");\n  return 1;\n}\n\nfunction parseStateAndTransport(c: Canon): { stateMode: string; transport: string } {\n  let stateMode = c.E;\n  let transport = c.R;\n  if (c.E.includes(\"+\")) {\n    const [left, right] = c.E.split(\"+\", 2);\n    stateMode = left;\n    if (transport === \"auto\") transport = right;\n  } else if (c.E.includes(\",\")) {\n    const [left, right] = c.E.split(\",\", 2);\n    stateMode = left;\n    if (transport === \"auto\") transport = right;\n  }\n  return { stateMode, transport };\n}\n\nfunction runtimeDir(): string {\n  return resolve(\".local/wid/typescript\");\n}\n\nfunction runtimePidFile(): string {\n  return resolve(runtimeDir(), \"service.pid\");\n}\n\nfunction runtimeLogFile(): string {\n  return resolve(runtimeDir(), \"service.log\");\n}\n\nfunction dataDir(c: Canon): string {\n  return c.D && c.D.length > 0 ? resolve(c.D) : resolve(\".local/services\");\n}\n\n/** Thin SQLite connection wrapper used by CLI helpers. */\ntype SqliteDb = {\n  exec: (sql: string) => void;\n  prepare: (sql: string) => { get: (...args: unknown[]) => unknown; run: (...args: unknown[]) => { changes?: number } };\n  close?: () => void;\n};\n\n/** Constructor signature for SQLite database handles. */\ntype SqliteCtor = new (path: string, options?: { timeout?: number }) => SqliteDb;\n\nfunction resolveNodeSqliteDatabaseSync(): SqliteCtor {\n  const proc = (globalThis as { process?: unknown }).process as\n    | { versions?: { node?: string }; getBuiltinModule?: (name: string) => unknown }\n    | undefined;\n  if (!proc?.versions?.node) throw new Error(\"SQLite requires Node.js\");\n  const builtin = typeof proc.getBuiltinModule === \"function\" ? proc.getBuiltinModule(\"node:sqlite\") : null;\n  if (builtin && typeof builtin === \"object\" && \"DatabaseSync\" in builtin) {\n    return (builtin as { DatabaseSync: SqliteCtor }).DatabaseSync;\n  }\n  throw new Error(\"node:sqlite unavailable in this Node runtime\");\n}\n\nfunction sqlStatePath(c: Canon): string {\n  return resolve(dataDir(c), \"wid_state.sqlite\");\n}\n\nfunction sqlStateKey(c: Canon): string {\n  return `wid:ts:${c.W}:${c.Z}:${c.T}`;\n}\n\nfunction sqlAllocateNextWid(c: Canon): string {\n  /** Node sqlite constructor used for state persistence. */\n  const DatabaseSync = resolveNodeSqliteDatabaseSync();\n  const db = new DatabaseSync(sqlStatePath(c), { timeout: 5000 });\n  try {\n    db.exec(\"PRAGMA journal_mode=WAL;\");\n    db.exec(\n      \"CREATE TABLE IF NOT EXISTS wid_state (k TEXT PRIMARY KEY, last_sec INTEGER NOT NULL, last_seq INTEGER NOT NULL)\"\n    );\n    const key = sqlStateKey(c);\n    db.prepare(\"INSERT OR IGNORE INTO wid_state(k,last_sec,last_seq) VALUES(?,0,-1)\").run(key);\n    const selectStmt = db.prepare(\"SELECT last_sec,last_seq FROM wid_state WHERE k=?\");\n    const casStmt = db.prepare(\"UPDATE wid_state SET last_sec=?,last_seq=? WHERE k=? AND last_sec=? AND last_seq=?\");\n\n    for (let i = 0; i < 256; i += 1) {\n      try {\n        const row = selectStmt.get(key) as { last_sec?: number; last_seq?: number } | undefined;\n        if (!row || typeof row.last_sec !== \"number\" || typeof row.last_seq !== \"number\") {\n          throw new Error(\"invalid SQL state row\");\n        }\n        const gen = new WidGen({ W: c.W, Z: c.Z, timeUnit: c.T });\n        gen.restoreState(row.last_sec, row.last_seq);\n        const id = gen.next();\n        const nextState = gen.state;\n        const updated = casStmt.run(nextState.lastSec, nextState.lastSeq, key, row.last_sec, row.last_seq);\n        if ((updated.changes ?? 0) === 1) return id;\n      } catch (e) {\n        const msg = (e as Error).message ?? \"\";\n        if (msg.includes(\"database is locked\")) continue;\n        throw e;\n      }\n    }\n    throw new Error(\"sql allocation contention: retry budget exhausted\");\n  } finally {\n    db.close?.();\n  }\n}\n\nfunction readPid(file: string): number | null {\n  try {\n    const value = readFileSync(file, \"utf-8\").trim();\n    if (!value) return null;\n    const pid = Number.parseInt(value, 10);\n    return Number.isNaN(pid) || pid <= 0 ? null : pid;\n  } catch {\n    return null;\n  }\n}\n\nfunction pidAlive(pid: number): boolean {\n  try {\n    process.kill(pid, 0);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nfunction sleepSeconds(sec: number): void {\n  if (sec <= 0) return;\n  const i32 = new Int32Array(new SharedArrayBuffer(4));\n  Atomics.wait(i32, 0, 0, sec * 1000);\n}\n\nfunction runDiscover(): number {\n  console.log(\n    JSON.stringify({\n      impl: \"typescript\",\n      orchestration: \"native\",\n      actions: [\n        \"discover\",\n        \"scaffold\",\n        \"run\",\n        \"start\",\n        \"stop\",\n        \"status\",\n        \"logs\",\n        \"saf\",\n        \"saf-wid\",\n        \"wir\",\n        \"wism\",\n        \"wihp\",\n        \"wipr\",\n        \"duplex\",\n      ],\n      transports: [\"auto\", \"mqtt\", \"ws\", \"redis\", \"null\", \"stdout\"],\n    })\n  );\n  return 0;\n}\n\nfunction runScaffold(c: Canon): number {\n  if (!c.D || c.D.length === 0) throw new Error(\"D=<name> required for A=scaffold\");\n  const root = resolve(c.D);\n  mkdirSync(resolve(root, \"state\"), { recursive: true });\n  mkdirSync(resolve(root, \"logs\"), { recursive: true });\n  console.log(`scaffolded ${root}`);\n  return 0;\n}\n\nfunction runStatus(): number {\n  const pidFile = runtimePidFile();\n  const logFile = runtimeLogFile();\n  const pid = readPid(pidFile);\n  if (pid !== null && pidAlive(pid)) {\n    console.log(`wid-typescript status=running pid=${pid} log=${logFile}`);\n    return 0;\n  }\n  try {\n    unlinkSync(pidFile);\n  } catch {}\n  console.log(\"wid-typescript status=stopped\");\n  return 0;\n}\n\nfunction runLogs(): number {\n  const logFile = runtimeLogFile();\n  if (!existsSync(logFile)) {\n    console.log(\"wid-typescript logs: empty\");\n    return 0;\n  }\n  process.stdout.write(readFileSync(logFile, \"utf-8\"));\n  return 0;\n}\n\nfunction runStop(): number {\n  const pidFile = runtimePidFile();\n  const pid = readPid(pidFile);\n  if (pid === null || !pidAlive(pid)) {\n    try {\n      unlinkSync(pidFile);\n    } catch {}\n    console.log(\"wid-typescript stop: not running\");\n    return 0;\n  }\n  try {\n    process.kill(pid, \"SIGTERM\");\n  } catch (e) {\n    throw new Error(`failed to stop pid=${pid}: ${(e as Error).message}`);\n  }\n  try {\n    unlinkSync(pidFile);\n  } catch {}\n  console.log(`wid-typescript stop: stopped pid=${pid}`);\n  return 0;\n}\n\nfunction daemonCanonicalArgs(c: Canon, action: string): string[] {\n  return [\n    `A=${action}`,\n    `W=${c.W}`,\n    `L=${c.L}`,\n    `D=${c.D.length > 0 ? c.D : \"#\"}`,\n    `I=${c.I}`,\n    `E=${c.E}`,\n    `Z=${c.Z}`,\n    `T=${c.T}`,\n    `R=${c.R}`,\n    `M=${c.M ? \"true\" : \"false\"}`,\n    `N=${c.N}`,\n  ];\n}\n\nfunction runStart(c: Canon): number {\n  const dir = runtimeDir();\n  mkdirSync(dir, { recursive: true });\n  const pidFile = runtimePidFile();\n  const logFile = runtimeLogFile();\n\n  const existing = readPid(pidFile);\n  if (existing !== null && pidAlive(existing)) {\n    console.log(`wid-typescript start: already-running pid=${existing} log=${logFile}`);\n    return 0;\n  }\n\n  mkdirSync(dirname(logFile), { recursive: true });\n  const fd = openSync(logFile, \"a\");\n  const child = spawn(process.execPath, [process.argv[1]!, \"__daemon\", ...daemonCanonicalArgs(c, \"run\")], {\n    detached: true,\n    stdio: [\"ignore\", fd, fd],\n  });\n  closeSync(fd);\n  child.unref();\n  writeFileSync(pidFile, `${child.pid}\\n`, \"utf-8\");\n  console.log(`wid-typescript start: started pid=${child.pid} log=${logFile}`);\n  return 0;\n}\n\nfunction runServiceLoop(c: Canon, action: string): number {\n  const { stateMode, transport: rawTransport } = parseStateAndTransport(c);\n  let transport = rawTransport === \"auto\" ? \"mqtt\" : rawTransport;\n  if (\n    [\"saf-wid\", \"wir\", \"wism\", \"wihp\", \"wipr\", \"duplex\"].includes(action) &&\n    !LOCAL_SERVICE_TRANSPORTS.has(transport)\n  ) {\n    throw new Error(`invalid transport for A=${action}: ${transport}`);\n  }\n\n  const dir = dataDir(c);\n  mkdirSync(dir, { recursive: true });\n  const logLevel = process.env.LOG_LEVEL || \"INFO\";\n  const max = c.N <= 0 ? Number.POSITIVE_INFINITY : c.N;\n  const gen = new WidGen({ W: c.W, Z: c.Z, timeUnit: c.T });\n\n  let i = 0;\n  while (i < max) {\n    i += 1;\n    const wid = gen.next();\n    if (transport !== \"null\") {\n      if ([\"saf-wid\", \"wism\", \"wihp\", \"wipr\"].includes(action)) {\n        console.log(\n          JSON.stringify({\n            impl: \"typescript\",\n            action,\n            tick: i,\n            transport,\n            W: c.W,\n            Z: c.Z,\n            time_unit: c.T,\n            wid,\n            interval: c.L,\n            log_level: logLevel,\n            data_dir: dir,\n          })\n        );\n      } else if (action === \"duplex\") {\n        const bTransport = c.I !== \"auto\" && LOCAL_SERVICE_TRANSPORTS.has(c.I) ? c.I : \"ws\";\n        console.log(\n          JSON.stringify({\n            impl: \"typescript\",\n            action: \"duplex\",\n            tick: i,\n            a_transport: transport,\n            b_transport: bTransport,\n            interval: c.L,\n            data_dir: dir,\n          })\n        );\n      } else {\n        console.log(\n          JSON.stringify({\n            impl: \"typescript\",\n            action,\n            tick: i,\n            transport,\n            interval: c.L,\n            log_level: logLevel,\n            data_dir: dir,\n            state_mode: stateMode,\n          })\n        );\n      }\n    }\n    if (i < max && c.L > 0) sleepSeconds(c.L);\n  }\n  return 0;\n}\n\nfunction runNativeOrchestration(c: Canon): number {\n  switch (c.A) {\n    case \"discover\":\n      return runDiscover();\n    case \"scaffold\":\n      return runScaffold(c);\n    case \"run\":\n      return runServiceLoop(c, \"run\");\n    case \"start\":\n      return runStart(c);\n    case \"stop\":\n      return runStop();\n    case \"status\":\n      return runStatus();\n    case \"logs\":\n      return runLogs();\n    case \"saf\":\n      return runServiceLoop(c, \"saf\");\n    case \"saf-wid\":\n      return runServiceLoop(c, \"saf-wid\");\n    case \"wir\":\n      return runServiceLoop(c, \"wir\");\n    case \"wism\":\n      return runServiceLoop(c, \"wism\");\n    case \"wihp\":\n      return runServiceLoop(c, \"wihp\");\n    case \"wipr\":\n      return runServiceLoop(c, \"wipr\");\n    case \"duplex\":\n      return runServiceLoop(c, \"duplex\");\n    default:\n      throw new Error(`unknown A=${c.A}`);\n  }\n}\n\nfunction runCanonical(args: string[]): number {\n  const c = parseCanonical(args);\n  if (c.A === \"help-actions\") {\n    printActions();\n    return 0;\n  }\n\n  const { stateMode } = parseStateAndTransport(c);\n  const canonDataDir = dataDir(c);\n  mkdirSync(canonDataDir, { recursive: true });\n  const genOptions = { W: c.W, Z: c.Z, timeUnit: c.T } as const;\n\n  if (c.A === \"next\") {\n    if (stateMode === \"sql\") {\n      console.log(sqlAllocateNextWid(c));\n    } else {\n      console.log(new WidGen(genOptions).next());\n    }\n    return 0;\n  }\n\n  if (c.A === \"stream\") {\n    const gen = stateMode === \"sql\" ? null : new WidGen(genOptions);\n    const max = c.N <= 0 ? Number.POSITIVE_INFINITY : c.N;\n    let emitted = 0;\n    while (emitted < max) {\n      if (stateMode === \"sql\") {\n        console.log(sqlAllocateNextWid(c));\n      } else {\n        console.log(gen!.next());\n      }\n      emitted += 1;\n      if (emitted < max && c.L > 0) sleepSeconds(c.L);\n    }\n    return 0;\n  }\n\n  if (c.A === \"healthcheck\") {\n    runHealthcheck([\n      \"--kind\",\n      \"wid\",\n      \"--W\",\n      String(c.W),\n      \"--Z\",\n      String(c.Z),\n      \"--time-unit\",\n      c.T,\n      \"--json\",\n    ]);\n    return 0;\n  }\n\n  if (c.A === \"sign\") return runSign(c);\n  if (c.A === \"verify\") return runVerify(c);\n  if (c.A === \"w-otp\") return runWOtp(c);\n\n  return runNativeOrchestration(c);\n}\n\nfunction runSelftest(): number {\n  const wg = new WidGen({ W: 4, Z: 0, timeUnit: \"sec\" });\n  const a = wg.next();\n  const b = wg.next();\n  if (!(a < b)) return 1;\n  if (!validateWid(a, 4, 0, \"sec\")) return 1;\n\n  const hg = new HLCWidGen({ node: \"node01\", W: 4, Z: 0, timeUnit: \"sec\" });\n  const h = hg.next();\n  if (!validateHlcWid(h, 4, 0, \"sec\")) return 1;\n\n  if (validateWid(\"20260212T091530.0000Z-node01\", 4, 0, \"sec\")) return 1;\n  if (validateHlcWid(\"20260212T091530.0000Z\", 4, 0, \"sec\")) return 1;\n  if (!validateWid(\"20260212T091530123.0000Z\", 4, 0, \"ms\")) return 1;\n  if (!validateHlcWid(\"20260212T091530123.0000Z-node01\", 4, 0, \"ms\")) return 1;\n  return 0;\n}\n\nfunction main(): number {\n  const args = process.argv.slice(2);\n  if (args.length === 0) {\n    printHelp();\n    return 2;\n  }\n\n  if (args[0] === \"__daemon\") {\n    try {\n      return runCanonical(args.slice(1));\n    } catch (e) {\n      console.error(`error: ${(e as Error).message}`);\n      return 1;\n    }\n  }\n\n  if (args.some((a) => a.includes(\"=\"))) {\n    try {\n      return runCanonical(args);\n    } catch (e) {\n      console.error(`error: ${(e as Error).message}`);\n      return 1;\n    }\n  }\n\n  const [cmd, ...rest] = args;\n  if (cmd === \"help\" || cmd === \"-h\" || cmd === \"--help\") {\n    printHelp();\n    return 0;\n  }\n\n  if (cmd === \"help-actions\") {\n    printActions();\n    return 0;\n  }\n\n  if (cmd === \"selftest\") {\n    return runSelftest();\n  }\n\n  try {\n    switch (cmd) {\n      case \"next\":\n        runNext(rest);\n        return 0;\n      case \"stream\":\n        runStream(rest);\n        return 0;\n      case \"validate\":\n        runValidate(rest);\n        return 0;\n      case \"parse\":\n        runParse(rest);\n        return 0;\n      case \"healthcheck\":\n        runHealthcheck(rest);\n        return 0;\n      case \"bench\":\n        runBench(rest);\n        return 0;\n      default:\n        throw new Error(`unknown command: ${cmd}`);\n    }\n  } catch (e) {\n    console.error(`error: ${(e as Error).message}`);\n    return 1;\n  }\n}\n\nprocess.exit(main());\n"],"mappings":"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","names":["gen","parsed"]}